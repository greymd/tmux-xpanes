language: bash
sudo: required
addons:
  apt:
    packages:
      - shellcheck
      - ncurses-dev
      - libevent-dev
      - gcc
      - make
      - curl

branches:
    only:
        - master
        - develop
        - /^develop-.*/
        - /^bugfix.*/
        - /^feature.*/

matrix:
    include:
          ## CASES are generated by Pairwise technique. Refer to ./test/travis.pict.

        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.8 CASES=8,9,17,23,25,30,35,41,62,63
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9 CASES=1,4,5,12,17,25,44,69,71,79
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9a CASES=10,13,15,17,18,27,29,39,45,48,59,65,80,81,82,83
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.0 CASES=10,16,31,34,42,48,50,53,54,59,72,73,81,85
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.1 CASES=3,11,13,19,22,23,41,42,43,46,71,72,79,85
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.2 CASES=2,4,16,22,24,31,42,57,69,72,77,84
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.3 CASES=7,23,24,25,32,35,44,84
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.4 CASES=6,14,15,33,42,45,49,52,69,84
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.5 CASES=1,5,10,16,18,23,39,40,45,47,58,59,83
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.6 CASES=5,15,18,32,37,40,42,43,44,52,55,78,83
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.7 CASES=2,9,20,21,26,28,34,35,36,37,46,57,60,67,68,71
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.8 CASES=5,6,9,12,14,20,26,37,38,40,63,66,70
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.9 CASES=3,12,19,56,58,64,65,74,76,77,78
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.9a CASES=4,10,11,34,40,48,51,61,66,75,83,85
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.8 CASES=1,5,7,36,38,59,69,83
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9 CASES=11,18,21,27,30,43,51,58,70,81
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9a CASES=2,5,12,14,19,25,33,73,84
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.0 CASES=2,13,22,26,33,49,58,71,80
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.1 CASES=26,27,29,35,44,47,48,53,56,63,78,80
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.2 CASES=1,3,10,17,26,27,50,53,62,70,83
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.3 CASES=3,11,12,13,14,17,31,36,37,40,41,47,65,67,68
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.4 CASES=9,19,35,63,65,73,80,81,85
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.5 CASES=6,8,15,22,27,28,46,49,52,56,57,66,81
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.6 CASES=1,8,9,10,19,20,22,29,30,34,47,54,56,60,61,64,79,82
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.7 CASES=1,3,4,33,39,45,65,72,73,78
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.8 CASES=3,10,21,24,25,29,42,45,46,47,71,77
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.9 CASES=10,15,38,39,40,42,44,51,75,79,82
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.9a CASES=3,13,16,21,23,24,28,32,43,55,62,63,69,72,74,76,77,78,84
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.8 CASES=13,22,24,34,42,43,47,70,71,80,82,84
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9 CASES=8,15,22,23,38,40,41,73
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9a CASES=7,9,30,32,34,43,52,62,72,78
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.0 CASES=3,9,12,20,24,25,43,44,62,63,66,70
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.1 CASES=1,14,15,21,32,34,50,52,54,55,65,83
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.2 CASES=33,36,51,56,58,63,66
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.3 CASES=20,34,45,58,61,66,73
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.4 CASES=2,10,24,25,29,30,37,38,46,48,66,68,71,82,83
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.5 CASES=7,14,17,32,35,38,53,73,79
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.6 CASES=4,6,11,14,23,27,39,67
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.7 CASES=14,18,19,50,52,55,56,69,70,74,76,77,85
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.8 CASES=4,8,18,28,39,51,57,59,75,80,81,83
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.9 CASES=5,13,16,17,18,21,24,26,28,41,48,49,53,60,72,83,84
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.9a CASES=5,12,18,19,22,29,31,33,35,37,38,39,46,64,65
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.8 CASES=10,11,19,20,21,26,28,48,56,73,77
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9 CASES=6,7,13,29,32,35,46,47,55,56,65,83,84
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9a CASES=11,22,23,42,49,51,66,79
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.0 CASES=6,18,23,41,45,55,56,57,65
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.1 CASES=2,24,25,31,38,39,40,58,62,70,73
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.2 CASES=6,12,14,19,37,39,41,44,55,85
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.3 CASES=5,9,19,26,28,33,43,70,71,79,80,82
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.4 CASES=3,7,17,20,22,23,27,28,34,47,50,51,54,57,67,72
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.5 CASES=12,50,60,78,82
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.6 CASES=2,7,13,17,31,41,46,50,59,68,72,75
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.7 CASES=5,8,16,30,32,40,42,48,49,58,59,64
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.8 CASES=13,33,35,36,52,56,61,73,76,82
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.9 CASES=1,2,4,20,35,36,52,63,66,69,73
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.9a CASES=8,15,20,27,30,44,53,54,57,71,74,81
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.8 CASES=14,31,37,65,79
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9 CASES=3,10,14,16,19,34,53,77,85
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9a CASES=1,3,8,16,35,37,40,41,44,47,53,55,56,63,69,70
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.0 CASES=1,4,7,8,21,27,32,39,51,69,82,83
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.1 CASES=5,8,17,18,28,45,51,57,66,77,84
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.2 CASES=8,11,21,23,38,40,43,47,54,59,73,78
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.3 CASES=15,16,22,29,30,46,48,49,59,72
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.4 CASES=8,12,16,31,39,40,56,58,59,60,61
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.5 CASES=3,20,21,24,25,30,41,44,63,68,70,77,80,84,85
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.6 CASES=12,26,28,33,36,38,48,51,69,71,80,81
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.7 CASES=7,11,13,15,24,25,44,54,63,66,79,80
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.8 CASES=15,41,50,64,65,68,69,74,76,84
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.9 CASES=6,9,11,27,30,33,34,37,43,45,47,50,54,57,61,62,67,75,80
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.9a CASES=2,36,41,42,52,59,79
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.8 CASES=3,4,12,18,27,40,44,45,81
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9 CASES=31,33,36,37,39,42,48,49,59,66,78,82
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a CASES=4,6,21,24,28,31,46,54,57,58
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.0 CASES=5,15,19,28,29,30,36,37,38,47,52
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.1 CASES=4,7,9,10,16,36,49,59,81,82
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.2 CASES=9,15,18,20,35,49,52,71,79,81
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3 CASES=1,4,18,38,39,60,77,78,81,83
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.4 CASES=1,11,13,26,36,53,55,77,78
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.5 CASES=2,9,13,26,33,34,37,42,43,51,54,61,67,69,72
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.6 CASES=16,21,25,45,49,53,57,63,65,66,70,73,74,76,84
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.7 CASES=17,22,23,29,31,38,41,43,64,75,84
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.8 CASES=1,2,16,22,27,34,43,54,62,72,79,85
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.9 CASES=8,25,29,31,32,68,70,71,85
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.9a CASES=7,14,17,25,26,49,50,56,60,67,70,80,82
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.8 CASES=15,16,29,39,46,49,58,66,72,78
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9 CASES=2,9,20,24,26,28,45,50,52,54,57,62,63,72,80
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9a CASES=20,26,36,38,50,71,77,85
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.0 CASES=11,14,17,35,40,46,77,78,79,84
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.1 CASES=6,12,20,30,33,37,69
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.2 CASES=5,7,13,25,28,29,30,32,34,45,46,48,65,80,82
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.3 CASES=8,10,21,27,42,56,69
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.4 CASES=4,5,18,21,32,41,43,44,70,79
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.5 CASES=4,11,19,29,31,36,48,55,65,71
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.6 CASES=3,24,35,58,77,85
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.7 CASES=6,10,12,27,47,51,53,61,81,82,83
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.8 CASES=7,11,17,19,23,30,31,32,44,48,49,53,55,58,60,67,78
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.9 CASES=7,14,22,23,46,55,59,64,74,75,81
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.9a CASES=1,6,9,45,47,58,68,73,76

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
    # Remove default tmux
  - if which tmux ;then sudo mv -f `which tmux` `which tmux`.bak ;fi
  - ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure --prefix=${TMPDIR}; make && sudo make install )
  - if [[ "$SH" == "bash" && "$SH_VERSION" != "default" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash* && ./configure; make && sudo make install && sudo mv /bin/bash /bin/bash.old && sudo cp ./bash /bin/bash ) ;fi
  - printf "set-window-option -g automatic-rename off\nset-option -g allow-rename off\n" >> "$HOME/.tmux.conf"
  - $SH ./test/test_generator.sh "${CASES}" > ./test/cases_pairwise.sh

script:
  - shellcheck ./bin/xpanes
  - PATH="${TMPDIR}/bin:${PATH}" $SH ./test/unitTest.sh
  - TRAVIS_BUILD_DIR="${TRAVIS_BUILD_DIR}" $SH ./test/cases_pairwise.sh
