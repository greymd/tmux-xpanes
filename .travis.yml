language: generic
sudo: required

matrix:
    include:
        - os: linux
          env: SH=bash TMUX_VERSION=0.8
        - os: linux
          env: SH=bash TMUX_VERSION=0.9
        - os: linux
          env: SH=bash TMUX_VERSION=1.0
        - os: linux
          env: SH=bash TMUX_VERSION=1.1
        - os: linux
          env: SH=bash TMUX_VERSION=1.2
        - os: linux
          env: SH=bash TMUX_VERSION=1.3
        - os: linux
          env: SH=bash TMUX_VERSION=1.4
        - os: linux
          env: SH=bash TMUX_VERSION=1.5
        - os: linux
          env: SH=bash TMUX_VERSION=1.6
        - os: linux
          env: SH=zsh TMUX_VERSION=1.6
        - os: linux
          env: SH=bash TMUX_VERSION=1.7
        - os: linux
          env: SH=zsh TMUX_VERSION=1.7
        - os: linux
          env: SH=bash TMUX_VERSION=1.8
        - os: linux
          env: SH=zsh TMUX_VERSION=1.8
        - os: linux
          env: SH=bash TMUX_VERSION=1.9
        - os: linux
          env: SH=zsh TMUX_VERSION=1.9
        - os: linux
          env: SH=bash TMUX_VERSION=1.9a
        - os: linux
          env: SH=zsh TMUX_VERSION=1.9a
        - os: linux
          env: SH=bash TMUX_VERSION=2.0
        - os: linux
          env: SH=zsh TMUX_VERSION=2.0
        - os: linux
          env: SH=bash TMUX_VERSION=2.1
        - os: linux
          env: SH=zsh TMUX_VERSION=2.1
        - os: linux
          env: SH=bash TMUX_VERSION=2.2
        - os: linux
          env: SH=zsh TMUX_VERSION=2.2
        - os: linux
          env: SH=bash SH_VERSION=3.0 TMUX_VERSION=2.3
        - os: linux
          env: SH=zsh SH_VERSION=3.1.7 TMUX_VERSION=2.3
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3
        - os: linux
          env: SH=zsh SH_VERSION=5.3.1 TMUX_VERSION=2.3
        - os: osx
          env: SH=bash TMUX_VERSION="default"
        - os: osx
          env: SH=zsh TMUX_VERSION="default"
        - os: osx
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a
        - os: osx
          env: SH=bash SH_VERSION=5.3 TMUX_VERSION=2.0
        - os: osx
          env: SH=bash TMUX_VERSION=2.1
        - os: osx
          env: SH=bash TMUX_VERSION=2.2
        - os: osx
          env: SH=bash TMUX_VERSION=2.3

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]] ;then sudo apt-get install -y ncurses-dev libevent-dev gcc make curl ;fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" && TMUX_VERSION == "default" ]] ; then if [[ ! $(which tmux) ]] ; then brew update; brew install tmux ;fi ;fi

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
  - if [[ "$TRAVIS_OS_NAME" == "linux" || ( "$TRAVIS_OS_NAME" == "osx" && TMUX_VERSION != "default" ) ]] ;then ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure; make && sudo make install ) ;fi # tmux 0.8 does not require ./configure
  - if [[ "$SH" == "bash" && ! -z "$SH_VERSION" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash-${SH_VERSION} && ./configure; make && sudo make install ) ;fi
  - if [[ "$SH" == "zsh" && ! -z "$SH_VERSION" ]];then (cd "$TMPDIR" && curl -L "https://sourceforge.net/projects/zsh/files/zsh/${SH_VERSION}/zsh-${SH_VERSION}.tar.gz/download" | tar zxv && cd zsh* && ./configure; make && sudo make install ) ;fi

script:
  - $SH ./test/test.sh
