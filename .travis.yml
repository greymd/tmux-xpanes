language: bash
sudo: required
addons:
  apt:
    packages:
      - shellcheck
      - ncurses-dev
      - libevent-dev
      - gcc
      - make
      - curl

branches:
    only:
        - master
        - develop
        - /^develop-.*/
        - /^bugfix.*/
        - /^feature.*/

matrix:
    include:
          ## CASES are generated by Pairwise technique. Refer to ./test/travis.pict.

        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.8 CASES=4,9,12,21,24,27,28,43,70
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9 CASES=4,6,7,8,27,29,34,35,36,47,48,53,54,79
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=1.9a CASES=5,13,30,48,49,58,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.0 CASES=1,8,15,23,24,45,57,62,63,78
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.1 CASES=3,18,19,20,22,25,37,38,43,63,69,73,77,80
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.2 CASES=5,27,31,39,40,44,49,66,81,84
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.3 CASES=1,11,18,26,42,46,58,59,66,69,70,82
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.4 CASES=10,16,17,27,32,41,47,52,55,70,71,77
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.5 CASES=2,6,9,14,16,20,48,50,58,60,82,84,85
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.6 CASES=3,10,13,22,29,51,56,61,67,73,81
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.7 CASES=6,18,33,39,46,47,56,64,72,83
        - os: linux
          env: SH=bash SH_VERSION=3.2 TMUX_VERSION=2.8 CASES=1,3,7,10,19,20,31,43,46,65,68,74,75,76,79
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.8 CASES=5,14,15,16,19,31,46,49,77
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9 CASES=9,10,17,23,28,30,42,55,58,63,77
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=1.9a CASES=19,20,23,24,25,26,33,47,54,59,63,69,70,85
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.0 CASES=2,12,27,36,43,49,53,55,65,80
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.1 CASES=4,14,30,48,57,62,66,72
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.2 CASES=7,16,33,35,42,45,71,73,85
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.3 CASES=13,15,22,28,29,39,41,44,56,83
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.4 CASES=1,6,9,37,38,43,49,50,57,61
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.5 CASES=8,12,33,37,65,67,69,73,78,79
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.6 CASES=21,24,34,35,40,41,48,68,70,72
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.7 CASES=3,11,15,22,25,40,41,51,60,74,75,76,79,80,82,84,85
        - os: linux
          env: SH=bash SH_VERSION=4.0 TMUX_VERSION=2.8 CASES=9,18,32,38,44,52,59,63,64,81,83
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.8 CASES=22,35,37,63,83
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9 CASES=2,3,14,26,41,51,52,62,65,72,81
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=1.9a CASES=14,16,18,42,43,72
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.0 CASES=4,6,10,11,14,22,31,37,39,40,41,46,50,69,70,79,84
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.1 CASES=2,7,12,17,33,36,49,82
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.2 CASES=20,24,26,29,37,47,55,56,63,77
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.3 CASES=5,9,19,25,31,34,35,67,68,71
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.4 CASES=3,21,25,33,40,42,54,61,73,78,79,81,82
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.5 CASES=10,15,23,24,46,53,83
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.6 CASES=1,5,7,9,16,23,27,30,32,42,44,45,57,58,60,65,66,74,75,76,82,83,85
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.7 CASES=8,19,28,38,48,54,59,64,66,78
        - os: linux
          env: SH=bash SH_VERSION=4.1 TMUX_VERSION=2.8 CASES=13,42,47,48,51,58,71,73,80
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.8 CASES=13,17,18,25,26,38,39,56,58,59,69,79,82,84
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9 CASES=11,13,15,33,43,57,78,80,84
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=1.9a CASES=3,7,9,15,27,35,38,40,53,65,73
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.0 CASES=5,21,44,48,59,83
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.1 CASES=1,5,16,31,34,41,46,47,59,81,85
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.2 CASES=9,12,13,21,22,28,34,36,51,54,57,62,65,70,78
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.3 CASES=8,10,23,24,38,43,72
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.4 CASES=2,13,19,23,29,34,45,63,84
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.5 CASES=4,19,22,26,29,30,36,40,42,43,45,61,68,71
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.6 CASES=4,6,12,14,18,31,33,49,50,52,64,80
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.7 CASES=1,10,12,14,20,24,32,37,45,50,55,57,67,69,73,77,81
        - os: linux
          env: SH=bash SH_VERSION=4.2 TMUX_VERSION=2.8 CASES=2,5,14,16,17,26,30,35,40,50,53,55,60,66,74,75,76,77
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.8 CASES=7,11,29,30,36,62,71,72,80
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9 CASES=1,16,18,20,25,31,37,46,56,66,70,71,73,83
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=1.9a CASES=2,4,10,11,12,21,22,34,45,46,50,56,78,82
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.0 CASES=18,20,26,29,30,35,52,56,73,81,85
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.1 CASES=8,9,10,15,29,32,35,40,42,50,51,52,70,71,78,79
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.2 CASES=3,6,14,17,23,38,53,58,72,82
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.3 CASES=3,21,32,37,45,47,49,65,77,79,84
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.4 CASES=7,24,28,30,36,48,51,66,68,83
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.5 CASES=1,17,27,28,39,44,52,54,59,72
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.6 CASES=8,11,15,19,20,39,43,55,60,64,69,74
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.7 CASES=4,5,7,13,16,36,42,61,63,75,76
        - os: linux
          env: SH=bash SH_VERSION=4.3 TMUX_VERSION=2.8 CASES=6,12,33,37,41,45,56,57,67,69,72,82
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.8 CASES=3,10,20,23,41,45,47,48,73,78
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9 CASES=12,24,32,40,45,49,59,85
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=1.9a CASES=1,8,28,29,31,32,36,37,39,51,57,79,80,81,83
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.0 CASES=16,17,19,38,42,66,71,72,82
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.1 CASES=6,11,13,24,26,44,53,55,58,84
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.2 CASES=1,2,4,11,15,19,25,43,50,83
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.3 CASES=4,7,27,30,33,36,61,67,80
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.4 CASES=4,5,11,14,15,18,35,39,46,53,60,69,85
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.5 CASES=3,18,21,25,31,32,35,38,41,47,49,51,56,63,70,77,81
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.6 CASES=17,25,28,38,46,54,59,68,77,84
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.7 CASES=9,17,26,30,34,49,52,58,65,74,75
        - os: linux
          env: SH=bash SH_VERSION=4.4 TMUX_VERSION=2.8 CASES=8,11,21,22,25,27,29,34,39,54,62,64,70,76
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.8 CASES=1,8,34,40,42,44,65,66,81
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9 CASES=5,19,21,22,38,39,44,50,69,82
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=1.9a CASES=6,17,41,44,52,55,62,66,71,84
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.0 CASES=3,7,9,13,25,28,32,33,34,47,51,54,58,77
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.1 CASES=21,23,27,28,39,45,54,56,65,83
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.2 CASES=8,10,18,30,32,41,46,48,52,59,69,79,80
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.3 CASES=12,14,16,17,20,40,48,60,73,78,81
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.4 CASES=8,12,20,22,26,31,44,56,58,59,65,67,72,80
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.5 CASES=5,7,11,13,34,55,57,66,80
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.6 CASES=2,26,36,37,47,53,63,71,75,78,79
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.7 CASES=2,21,23,27,29,31,35,43,44,53,64,68,70,71,74,76
        - os: linux
          env: SH=bash SH_VERSION=5.0 TMUX_VERSION=2.8 CASES=4,15,23,24,28,36,49,61,78,84,85

before_script:
  - export TMPDIR=$TRAVIS_BUILD_DIR/tmp
  - mkdir -p $TMPDIR
    # Remove default tmux
  - if which tmux ;then sudo mv -f `which tmux` `which tmux`.bak ;fi
  - ( cd "$TMPDIR" && curl -L "https://github.com/tmux/tmux/releases/download/${TMUX_VERSION}/tmux-${TMUX_VERSION}.tar.gz" | tar zxv && cd tmux-${TMUX_VERSION} && ./configure --prefix=${TMPDIR}; make && sudo make install )
  - if [[ "$SH" == "bash" && "$SH_VERSION" != "default" ]];then (cd "$TMPDIR" && curl "http://ftp.gnu.org/gnu/bash/bash-${SH_VERSION}.tar.gz" | tar xvz && cd bash* && ./configure; make && sudo make install && sudo mv /bin/bash /bin/bash.old && sudo cp ./bash /bin/bash ) ;fi
  - printf "set-window-option -g automatic-rename off\nset-option -g allow-rename off\n" >> "$HOME/.tmux.conf"
  - $SH ./test/test_generator.sh "${CASES}" > ./test/cases_pairwise.sh

script:
  - shellcheck ./bin/xpanes
  - PATH="${TMPDIR}/bin:${PATH}" $SH ./test/unitTest.sh
  - TRAVIS_BUILD_DIR="${TRAVIS_BUILD_DIR}" $SH ./test/cases_pairwise.sh
